<?xml version="1.0" encoding="UTF-8"?>
<!--

    GSC-18128-1, "Core Flight Executive Version 6.7"
    LEW-19710-1, "CCSDS electronic data sheet implementation"

    Copyright (c) 2006-2019 United States Government as represented by
    the Administrator of the National Aeronautics and Space Administration.
    All Rights Reserved.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

    This document adheres to the Electronic Data Sheet (EDS) XML schema
    as prescribed in CCSDS book 876.0.

    Purpose:
      This describes all interface objects for the Executive Services (CFE_ES)
      core application

-->
<PackageFile xmlns="http://www.ccsds.org/schema/sois/seds">
  <Package name="HK" shortDescription="Housekeeping">

    <DataTypeSet>

      <ContainerDataType name="CMD" baseType="CFE_HDR/CommandHeader">
      </ContainerDataType>

       <ContainerDataType name="HkTlm_Payload" shortDescription="HK housekeeping">
        <EntryList>
          <Entry name="CmdCounter" type="BASE_TYPES/uint8" shortDescription="Count of valid commands received" />
          <Entry name="ErrCounter" type="BASE_TYPES/uint8" shortDescription="Count of invalid commands received" />
          <Entry name="CombinedPacketsSent" type="BASE_TYPES/uint8" shortDescription="Count of combined tlm pkts sent" />
          <Entry name="MissingDataCtr" type="BASE_TYPES/uint8" shortDescription="Number of times missing data was detected" />
          <Entry name="MemPoolHandle" type="BASE_TYPES/uint8" shortDescription="Memory pool handle used to get mempool diags" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="HousekeepingPkt" baseType="CFE_HDR/TelemetryHeader">
        <EntryList>
          <Entry type="HkTlm_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="NoopCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="0" />
        </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="ResetCtrsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="1" />
        </ConstraintSet>
      </ContainerDataType>

     <ContainerDataType name="CopyTableEntry" shortDescription="#copy_table_entry">
        <EntryList>
          <Entry name="InputMid" type="CFE_SB/MsgId" shortDescription="MsgId of the input packet" />
          <Entry name="InputOffset" type="BASE_TYPES/uint16" shortDescription="ByteOffset into the input pkt where copy will begin" />
          <Entry name="OutputMid" type="CFE_SB/MsgId" shortDescription="MsgId of the output packet" />
          <Entry name="OutputOffset" type="BASE_TYPES/uint16" shortDescription="ByteOffset into the output pkt where data will be placed" />
          <Entry name="NumBytes" type="BASE_TYPES/uint16" shortDescription="Number of data bytes to copy from input to output pkt" />
          </EntryList>
      </ContainerDataType>

      <ArrayDataType name="CopyTable" dataTypeRef="CopyTableEntry">
        <DimensionList>
          <Dimension size="${HK/COPY_TABLE_ENTRIES}" />
        </DimensionList>
      </ArrayDataType>

     <!--
     <ContainerDataType name="runtime_table_entry" shortDescription="#runtime_table_entry">
        <EntryList>
          attribute 'type' could not be resolved - CFE_SB/Telecommand OutputPktAddr's type is a typedef union
          CFE_SB_Buffer_t *OutputPktAddr;

          typedef union CFE_SB_Msg
          {
              CFE_MSG_Message_t Msg;        /**< \brief Base message type without enforced alignment */
              long long int     LongInt;    /**< \brief Align to support Long Integer */
              long double       LongDouble; /**< \brief Align to support Long Double */
          } CFE_SB_Buffer_t;


          <Entry name="OutputPktAddr" type="CFE_SB/Telecommand" shortDescription="Addr of output packet" />
          <Entry name="InputMidSubscribed" type="BASE_TYPES/uint8" shortDescription="Indicates if input MID has been subscribed to" />
          <Entry name="DataPresent" type="BASE_TYPES/uint8" shortDescription="Indicates if the data associated with the entry is present" />
          </EntryList>
      </ContainerDataType>


      <ArrayDataType name="RuntimeTable" dataTypeRef="runtime_table_entry">
        <DimensionList>
          <Dimension size="${HK/COPY_TABLE_ENTRIES}" />
        </DimensionList>
      </ArrayDataType>
      -->

      <ContainerDataType name="NoArgCmd_Payload" shortDescription="No-Operation command packet structure">
      </ContainerDataType>

      <ContainerDataType name="SendCombinedPkt_Payload" shortDescription="SEND_COMBINED_PKT Request">
        <EntryList>
          <Entry name="MessageId" type="BASE_TYPES/uint16" shortDescription="MessageId to send" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="HousekeepingCmd" baseType="CFE_HDR/CommandHeader" shortDescription="Send Housekeeping command" />

      <ContainerDataType name="SendCombinedPkt" baseType="CMD">
        <EntryList>
          <Entry type="SendCombinedPkt_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

    </DataTypeSet>

    <ComponentSet>
      <Component name="Application">
        <RequiredInterfaceSet>
          <Interface name="CMD" shortDescription="Software bus telecommand interface" type="CFE_SB/Telecommand">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="CMD" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="SEND_HK" shortDescription="Send telemetry command interface" type="CFE_SB/Telecommand">
            <!-- This uses a bare spacepacket with no payload -->
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="HousekeepingCmd" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="SEND_COMBINED_PKT" shortDescription="Send combined telemetry packets command interface" type="CFE_SB/Telecommand">
            <!-- This uses a bare spacepacket with no payload -->
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="SendCombinedPkt" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="HousekeepingPkt" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_COMBINED_PKT1_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="CFE_HDR/TelemetryHeader" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_COMBINED_PKT2_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="CFE_HDR/TelemetryHeader" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_COMBINED_PKT3_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="CFE_HDR/TelemetryHeader" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_COMBINED_PKT4_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="CFE_HDR/TelemetryHeader" />
            </GenericTypeMapSet>
          </Interface>
        </RequiredInterfaceSet>
        <Implementation>
          <VariableSet>
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CmdTopicId" initialValue="${CFE_MISSION/HK_CMD_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="SendHkTopicId" initialValue="${CFE_MISSION/HK_SEND_HK_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="SendCombinedPktTopicID" initialValue="${CFE_MISSION/HK_SEND_COMBINED_PKT_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="HkTlmTopicId" initialValue="${CFE_MISSION/HK_HK_TLM_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CombinedPkt1TlmTopicId" initialValue="${CFE_MISSION/HK_COMBINED_PKT1_TLM_TOPICID)}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CombinedPkt2TlmTopicId" initialValue="${CFE_MISSION/HK_COMBINED_PKT2_TLM_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CombinedPkt3TlmTopicId" initialValue="${CFE_MISSION/HK_COMBINED_PKT3_TLM_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CombinedPkt4TlmTopicId" initialValue="${CFE_MISSION/HK_COMBINED_PKT4_TLM_TOPICID}" />
          </VariableSet>
          <!-- Assign fixed numbers to the "TopicId" parameter of each interface -->
          <ParameterMapSet>
            <ParameterMap interface="CMD" parameter="TopicId" variableRef="CmdTopicId" />
            <ParameterMap interface="SEND_HK" parameter="TopicId" variableRef="SendHkTopicId" />
            <ParameterMap interface="SEND_COMBINED_PKT" parameter="TopicId" variableRef="SendCombinedPktTopicID" />
            <ParameterMap interface="HK_TLM" parameter="TopicId" variableRef="HkTlmTopicId" />
            <ParameterMap interface="HK_COMBINED_PKT1_TLM" parameter="TopicId" variableRef="CombinedPkt1TlmTopicId" />
            <ParameterMap interface="HK_COMBINED_PKT2_TLM" parameter="TopicId" variableRef="CombinedPkt2TlmTopicId" />
            <ParameterMap interface="HK_COMBINED_PKT3_TLM" parameter="TopicId" variableRef="CombinedPkt3TlmTopicId" />
            <ParameterMap interface="HK_COMBINED_PKT4_TLM" parameter="TopicId" variableRef="CombinedPkt4TlmTopicId" />
          </ParameterMapSet>
        </Implementation>
      </Component>
    </ComponentSet>

  </Package>
</PackageFile>
